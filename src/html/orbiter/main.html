<div
    ng-controller="OrbiterCtlr as orb"
    class="m-height100"
    ng-mouseup="orb.trackingMouseMove = false"
    ng-mouseleave="orb.trackingMouseMove = false"
    ng-mousemove="orb.trackingMouseMove ? orb.mouseMoveMethod($event) : null"
    ng-class="orb.trackingMouseMove ? 'c-tracking-mousemove blur-'+orb.dialogueOpen : 'c-ckrank_main blur-'+orb.dialogueOpen"
>
    <div class="c-orbiter_body">
        <div class="c-orbiter_body-inner">
            <orbiter-canvas ng-style="{'width':orb.$localStorage.Orbiter.canvasWidth}"></orbiter-canvas>
            <div class="c-section-resize m-horizontal" ng-style="{'left':orb.$localStorage.Orbiter.canvasWidth}" ng-mousedown="orb.trackingMouseMove=true; orb.mouseMoveMethod=orb.canvasElements; orb.sizingElement=[$event, 'target', 'previousSibling']"></div>
            <orbiter-sidebar ng-style="{'left':orb.$localStorage.Orbiter.canvasWidth, 'width':orb.$localStorage.Orbiter.elementsWidth}"></orbiter-sidebar>
        </div>
    </div>






    <div class="c-orbiter_menu">
        <div class="c-orbiter_menu-item" ng-click="orb.OrbiterService.save()"><i class="fa fa-check"></i></div>
        <div class="c-orbiter_menu-item c-dropdown">
            <div><i class="fa fa-plus"></i></div>
            <div class="c-dropdown_list">
                <div
                    class="c-elements_item"
                    ng-class="'type'+element.label"
                    ng-repeat="element in orb.OrbiterElementTypes track by $index"
                    orbiter-draggable="true"
                    orbiter-drag-data="element"
                ><span ng-bind="element.label"></span></div>
            </div>
        </div>
    </div>






    <div ng-if="orb.OrbiterService.newDataObject" class="c-dialogue">
        <div class="c-dialogue_inner">
            <h2>Data object</h2>
            <div class="c-dialogue_input">
                <input type="text" ng-model="orb.OrbiterService.newDataObject.label" placeholder="object name" />
            </div>
            <div class="c-dialogue_input">
                <textarea ng-model="orb.OrbiterService.newDataObject.value"></textarea>
            </div>
            <div class="c-dialogue_input" style="text-align: right;">
                <button class="circle" ng-click="orb.InteractiveService.dataObjects[orb.OrbiterService.newDataObject.label] = orb.OrbiterService.newDataObject; orb.OrbiterService.newDataObject=null" ng-if="orb.OrbiterService.newDataObject.label">&#10004;</button>
                <button class="circle" ng-click="orb.OrbiterService.newDataObject=null">&#10006;</button>
            </div>
        </div>
    </div>

    <div ng-if="orb.OrbiterService.propertyDialogue" class="c-dialogue">
        <div class="c-dialogue_inner">
            <h2>Available properties</h2>
            <div class="c-dialogue_input">
                <!-- <div
                    ng-repeat="property in orb.InteractiveService.properties track by $index"
                    ng-click="orb.OrbiterService.propertyDialogue.bind=property; orb.debug(orb.OrbiterService.propertyDialogue); orb.OrbiterService.propertyDialogue=null;"
                    ng-bind="property.label"
                    class="c-dialogue_event-property-item"
                    ng-click="orb.InteractiveService.properties[orb.InteractiveService.propertyPrefix + orb.OrbiterService.propertyDialogue.element.id].properties[orb.OrbiterService.propertyDialogue.propertyKey].bind = property; orb.debug(orb.OrbiterService.propertyDialogue); orb.OrbiterService.propertyDialogue=null;"
                ></div>
                ng-click="orb.InteractiveService.properties[orb.InteractiveService.propertyPrefix + orb.OrbiterService.propertyDialogue.element.id][orb.OrbiterService.propertyDialogue.propertyKey] = property; orb.debug(orb.OrbiterService.propertyDialogue); orb.OrbiterService.propertyDialogue=null;"
            -->
                <div
                    ng-repeat="property in orb.InteractiveService.properties track by $index"
                    ng-click="orb.OrbiterService.propertyDialogue.element.properties[orb.OrbiterService.propertyDialogue.propertyKey].bind = property.key; orb.OrbiterService.propertyDialogue=null;"
                    ng-bind="property.label"
                    ng-if="property.label"
                    class="c-dialogue_event-property-item"
                ></div>
            </div>
            <div class="c-dialogue_input" style="text-align: right;">
                <button class="circle" ng-click="orb.OrbiterService.propertyDialogue=null">&#10006;</button>
            </div>
        </div>
    </div>




    <div ng-if="orb.OrbiterService.currentEventObject" class="c-dialogue" ng-init="eventObj=orb.OrbiterService.currentEventObject">
        <div class="c-dialogue_inner" ng-class="orb.dialogueSidebar" ng-init="orb.dialogueSidebar=''; orb.dialogueTaskToAddTo=null">
            <h2>Functional fun</h2>
            <div class="c-dialogue_left">
                <div class="c-dialogue_input">
                    <input type="text" ng-model="eventObj.label" placeholder="Function description" />
                </div>
                <h4>Tasks&nbsp;&nbsp;<button class="circle" ng-click="eventObj.fn.push({label:null, method:null, arguments:[{label:null, custom:true, value:null, valueLabel:null}]});"><i class="fa fa-plus"></i></button></h4>
                <div class="c-dialogue_input tasks" ng-repeat="task in eventObj.fn track by $index">
                    <input type="text" ng-model="task.label" placeholder="task name" />
                    <div class="c-dialogue_input" ng-if="task.method">
                        <span class="c-task_action-string">Run function <span ng-bind="task.method.label" class="c-task_action-target"></span></span>
                    </div>
                    <div class="c-dialogue_input" ng-if="task.property">
                        <span class="c-task_action-string">Set <span ng-bind="task.property.label" class="c-task_action-target"></span> to equal <input type="text" ng-model="task.newValue" /></span>
                    </div>
                    <h4 style="margin: 14px 0px 0px;">Arguments&nbsp;&nbsp;<button class="circle" ng-click="task.arguments.push({label:null, custom:true, value:null, valueLabel:null})"><i class="fa fa-plus"></i></button></h4>
                    <div ng-repeat="argument in task.arguments track by $index">
                        <input type="text" ng-model="argument.label" placeholder="argument name" style="width:33%;margin-right:7px;vertical-align:middle;" />
                        <div ng-if="argument.custom" style="display:inline-block;width:33%;margin-right:7px;vertical-align:middle;">
                            <input type="text" ng-model="argument.value" placeholder="argument string" />
                        </div>
                        <div ng-if="!argument.custom" style="display:inline-block;width:33%;margin-right:7px;vertical-align:middle;">
                            <div ng-bind="argument.valueLabel"></div>
                        </div>
                        <button class="circle orange" style="width: 30px;vertical-align:middle;" ng-click="orb.OrbiterService.removeArrayElement(task.arguments, $index)"><i class="fa fa-trash"></i></button>
                    </div>
                    <div class="c-dialogue_input">
                        <button class="" style="margin: 7px 0px;" ng-click="orb.dialogueSidebar = orb.dialogueSidebar === 'properties' ? '' : 'properties'; orb.dialogueTaskToAddTo=task">Properties</button>
                        <button class="" style="margin: 7px 0px;" ng-click="orb.dialogueSidebar = orb.dialogueSidebar === 'methods' ? '' :'methods'; orb.dialogueTaskToAddTo=task">Methods</button>
                        <button class="orange" style="margin: 7px 0px;" ng-click="orb.OrbiterService.removeArrayElement(eventObj.fn, $index)">Delete task</button>
                    </div>
                </div>
                <div class="c-dialogue_input done_buttons" style="text-align: right;">
                    <button class="circle" ng-if="eventObj.label && eventObj.fn.length" ng-click="orb.OrbiterService.currentEventObject=null" ng-if="eventObj.label && eventObj.fn.length"><i class="fa fa-check"></i></button>
                    <button class="circle" ng-if="!eventObj.label || !eventObj.fn.length" ng-click="orb.OrbiterService.currentEventObject=null"><i class="fa fa-close"></i></button>
                </div>
            </div>
            <div class="c-dialogue_right">
                <div class="c-dialogue_event-property-list">
                    <h3>Properties</h3>
                    <div ng-repeat="property in orb.InteractiveService.properties track by $index" ng-if="property.label" ng-click="orb.dialogueTaskToAddTo.property=property;orb.dialogueSidebar='';orb.dialogueTaskToAddTo=null;" ng-bind="property.label" class="c-dialogue_event-property-item"></div>
                </div>

                <div class="c-dialogue_event-method-list">
                    <h3>Methods</h3>
                    <div ng-repeat="method in orb.InteractiveService.methods track by $index" ng-click="orb.dialogueTaskToAddTo.method=method;orb.dialogueSidebar='';orb.dialogueTaskToAddTo=null;" ng-bind="method.label" class="c-dialogue_event-method-item"></div>
                </div>
            </div>
        </div>
    </div>
</div>
